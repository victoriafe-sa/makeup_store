<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head}"></head>
<body class="bg-gray-50 font-sans flex flex-col min-h-screen">
    
    <nav th:replace="~{layout :: navbar}"></nav>

    <main class="flex-grow container mx-auto px-6 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Seu Carrinho</h1>

        <!-- Mensagem de Erro de Estoque -->
        <div th:if="${erro}" class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-r shadow-sm">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-circle text-red-500"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-red-700 font-bold">Não foi possível finalizar:</p>
                    <p class="text-sm text-red-600" th:text="${erro}">Erro de estoque</p>
                </div>
            </div>
        </div>

        <div th:if="${#lists.isEmpty(itens)}" class="text-center py-16 bg-white rounded-xl shadow-sm">
            <i class="fas fa-shopping-basket text-6xl text-gray-200 mb-4"></i>
            <p class="text-gray-500 text-xl mb-6">Seu carrinho está vazio.</p>
            <a href="/produtos" class="bg-pink-600 text-white px-8 py-3 rounded-full hover:bg-pink-700 transition font-semibold">Começar a Comprar</a>
        </div>

        <div th:unless="${#lists.isEmpty(itens)}" class="flex flex-col lg:flex-row gap-8">
            <!-- Lista de Itens -->
            <div class="lg:w-2/3">
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 text-gray-600 uppercase text-sm">
                            <tr>
                                <th class="px-6 py-4">Produto</th>
                                <th class="px-6 py-4 text-center">Qtd</th>
                                <th class="px-6 py-4 text-right">Subtotal</th>
                                <th class="px-6 py-4"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr th:each="item : ${itens}">
                                <td class="px-6 py-4">
                                    <p class="font-semibold text-gray-800" th:text="${item.produto.nome}">Produto</p>
                                    <p class="text-sm text-gray-500" th:text="|R$ ${#numbers.formatDecimal(item.precoUnitario, 1, 2, 'COMMA')} un.|">R$ 10,00</p>
                                </td>
                                <td class="px-6 py-4 text-center">
                                    <!-- Controle de Quantidade -->
                                    <form th:action="@{/carrinho/atualizar/{id}(id=${item.produto.id})}" method="post" class="flex items-center justify-center gap-2">
                                        <button type="submit" name="quantidade" th:value="${item.quantidade - 1}" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-pink-100 text-gray-600 hover:text-pink-600 transition flex items-center justify-center">
                                            <i class="fas fa-minus text-xs"></i>
                                        </button>
                                        
                                        <span class="font-bold w-8 text-center" th:text="${item.quantidade}">1</span>
                                        
                                        <button type="submit" name="quantidade" th:value="${item.quantidade + 1}" 
                                                th:disabled="${item.quantidade >= item.produto.estoque}"
                                                class="w-8 h-8 rounded-full bg-gray-100 hover:bg-pink-100 text-gray-600 hover:text-pink-600 transition flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i class="fas fa-plus text-xs"></i>
                                        </button>
                                    </form>
                                </td>
                                <td class="px-6 py-4 text-right font-bold text-gray-800" th:text="|R$ ${#numbers.formatDecimal(item.getPrecoTotal(), 1, 2, 'COMMA')}|">
                                    R$ 10,00
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <a th:href="@{/carrinho/remover/{id}(id=${item.produto.id})}" class="text-red-400 hover:text-red-600">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Resumo e Checkout -->
            <div class="lg:w-1/3">
                <form th:action="@{/carrinho/finalizar}" method="post" class="bg-white rounded-xl shadow-sm p-6 sticky top-24">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Resumo do Pedido</h2>
                    
                    <div class="flex justify-between mb-2 text-gray-600">
                        <span>Subtotal</span>
                        <span th:text="|R$ ${#numbers.formatDecimal(total, 1, 2, 'COMMA')}|">R$ 100,00</span>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Frete</label>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="frete" value="Padrao (Gratis)" checked class="text-pink-600 focus:ring-pink-500">
                                <span class="ml-3 flex-1 text-sm font-medium">Padrão (5-7 dias)</span>
                                <span class="text-sm text-green-600 font-bold">Grátis</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="frete" value="Expresso (R$ 15,00)" class="text-pink-600 focus:ring-pink-500">
                                <span class="ml-3 flex-1 text-sm font-medium">Expresso (1-2 dias)</span>
                                <span class="text-sm text-gray-800 font-bold">R$ 15,00</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4 mt-4 flex justify-between items-center mb-6">
                        <span class="text-lg font-bold text-gray-800">Total</span>
                        <span class="text-2xl font-bold text-pink-600" th:text="|R$ ${#numbers.formatDecimal(total, 1, 2, 'COMMA')}|">R$ 100,00</span>
                    </div>

                    <button type="submit" class="w-full bg-pink-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-pink-700 transition shadow-lg hover:shadow-xl">
                        Finalizar Compra
                    </button>
                </form>
            </div>
        </div>
    </main>

    <footer th:replace="~{layout :: footer}"></footer>
</body>
</html>